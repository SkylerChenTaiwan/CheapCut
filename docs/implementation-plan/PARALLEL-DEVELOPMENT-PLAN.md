# CheapCut 五人並行開發執行計劃

**版本**: 1.0
**建立日期**: 2025-10-07
**目標**: 五個 Claude Code 同時並行開發,最大化開發效率

---

## 📋 重要前置作業

### ⚠️ 開始開發前必須先修復的問題

根據一致性分析報告,以下問題必須在開始並行開發前處理:

- [ ] **P0-1**: 新增 Task 3.9 (時間軌編輯器)
- [ ] **P0-2**: 修改 Task 3.6 (加入進度顯示)
- [ ] **P0-3**: 修改 Task 2.12 (異步處理機制)
- [ ] **P1-1**: 修改 Task 2.10 (快取邏輯)

**預估修復時間**: 2-3 小時 (更新文件)

---

## 🎯 並行開發策略總覽

### 關鍵原則

1. **Sequential First**: Phase 0 和 Phase 1 必須順序執行 (基礎建設)
2. **Parallel Core**: Phase 2 可以分 4 組並行開發 (核心引擎)
3. **Parallel UI**: Phase 3 可以分 3 組並行開發 (前端介面)
4. **Sequential Integration**: Phase 4 必須順序執行 (整合測試)
5. **Parallel Admin**: Phase 5 可以並行開發 (管理後台)

### 人員分配

| Claude Code | 角色 | 主要負責 | 特點 |
|------------|------|---------|------|
| **Claude A** | 組長 | Prompt 管理、儲存、選片邏輯 | 必須先完成關鍵 Task |
| **Claude B** | 素材專家 | 影片分析、片段處理 | 可獨立並行 |
| **Claude C** | 配音專家 | STT、語意分析、配音切分 | 可獨立並行 |
| **Claude D** | 選片專家 | AI 選片、時間軸生成 | 依賴 Claude A, B, C |
| **Claude E** | 渲染專家 | FFmpeg、影片合成、字幕配樂 | 依賴 Claude D |

---

## 📅 Phase-by-Phase 執行計劃

---

## Phase 0: 測試環境建立 (順序執行)

**目標**: 建立驗收測試框架
**總時間**: 7-11 小時
**執行方式**: 單人順序執行 (任一 Claude)

### 執行步驟

```
□ Task 0.1: 建立驗收 CLI 框架 (3-4 小時)
□ Task 0.2: 環境檢查測試 (2-3 小時)
□ Task 0.3: 測試資料準備 (4-5 小時) ⚠️ 時間已更新
```

### 驗收標準

- [ ] 可執行 `npm run verify:all`
- [ ] 測試報告自動產生
- [ ] 所有測試資料已準備

**完成後**: 所有 Claude 都可以使用測試框架驗收自己的 Task

---

## Phase 1: 基礎設施建立 (順序執行)

**目標**: 建立資料庫、認證、API 框架、Redis、Logger、成本追蹤
**總時間**: 18-25 小時
**執行方式**: 單人順序執行 (任一 Claude)

### 執行步驟

```
□ Task 1.1: 資料庫 Schema (2-3 小時)
□ Task 1.2: Supabase Auth (2-3 小時)
□ Task 1.3: API 基礎架構 (3-4 小時)
□ Task 1.4: Redis 設定 (2-3 小時)
□ Task 1.5: Logger 服務 (4-5 小時)
□ Task 1.6: 成本與效能追蹤 (5-6 小時)
```

### 驗收標準

- [ ] 資料庫 Schema 建立完成
- [ ] 用戶可以註冊/登入
- [ ] API 伺服器可運作
- [ ] 所有 API 路由骨架建立
- [ ] Redis 快取正常運作
- [ ] 背景任務佇列已設定
- [ ] Logger 服務正常運作
- [ ] 成本與效能追蹤正確記錄

**完成後**: 進入 Phase 2 並行開發階段

---

## Phase 2: 核心引擎實作 (並行開發 ⭐️)

**目標**: 實作四大核心引擎
**總時間**: 預估 3-4 天 (實際日曆時間)
**執行方式**: 5 人並行,需注意同步點

---

### 🔴 同步點說明 (Critical!)

| 同步點 | 時機 | 誰在等待 | 等待什麼完成 |
|-------|------|---------|------------|
| **Sync-1** | Day 1 結束 | Claude B, C | Claude A 完成 Task 2.0 |
| **Sync-2** | Day 2 結束 | Claude A | Claude B 完成 Task 2.4 且 Claude C 完成 Task 2.7 |
| **Sync-3** | Day 3 中 | Claude D | Claude A 完成 Task 2.8 |
| **Sync-4** | Day 3 結束 | Claude E | Claude D 完成 Task 2.10 |

---

### Claude A (組長路線)

**角色**: Prompt 管理 → 儲存上傳 → 候選查詢

#### 任務清單

```
Day 1 (🔴 阻塞其他人)
□ Task 2.0: Prompt 管理系統 (3-4 小時)
  - 實作 PromptManager
  - 建立 Prompt 檔案結構
  - 實作版本控制機制
  - 實作快取機制
  ⚠️ 完成後通知 Claude B 和 C (Sync-1)

Day 1-2
□ Task 2.1: GCS 儲存與上傳 (3-4 小時)
  - 設定 GCP Cloud Storage
  - 實作上傳 API
  - 實作 presigned URL 生成
  - 整合前端上傳

Day 2-3 (等待 Claude B 和 C)
⏸ 等待 Claude B 完成 Task 2.4
⏸ 等待 Claude C 完成 Task 2.7
✅ Sync-2 完成後開始

Day 3
□ Task 2.8: 候選片段查詢 (3-4 小時)
  - 實作標籤查詢邏輯
  - 實作相似度排序
  - 整合 segments 和 segment_tags
  ⚠️ 完成後通知 Claude D (Sync-3)
```

**預估總時間**: 9-12 小時 (分散在 3 天)

#### 驗收標準

- [ ] Task 2.0: Prompt 可正確載入與快取
- [ ] Task 2.1: 檔案可上傳到 GCS
- [ ] Task 2.8: 可根據關鍵字查詢候選片段

---

### Claude B (素材處理路線)

**角色**: 影片分析 → 標籤轉換 → 片段切分

#### 任務清單

```
Day 1
⏸ 等待 Claude A 完成 Task 2.0 (Sync-1)
  可以先準備環境、閱讀文件

Day 1-2
□ Task 2.2: Google Video AI 整合 (4-5 小時)
  - 設定 Video Intelligence API
  - 實作影片分析呼叫
  - 儲存分析結果到資料庫

Day 2
□ Task 2.3: 標籤轉換與儲存 (3-4 小時)
  - 實作標籤標準化
  - 儲存到 segment_tags 表
  - 實作標籤去重邏輯

Day 2-3
□ Task 2.4: 影片切分與縮圖生成 (4-5 小時)
  - 實作 FFmpeg 影片切分
  - 生成縮圖並上傳 GCS
  - 更新 segments 表
  ⚠️ 完成後通知 Claude A (Sync-2)
```

**預估總時間**: 11-14 小時 (分散在 2-3 天)

#### 驗收標準

- [ ] Task 2.2: 影片可自動分析並產生標籤
- [ ] Task 2.3: 標籤正確儲存到資料庫
- [ ] Task 2.4: 影片可切分為片段並生成縮圖

---

### Claude C (配音處理路線)

**角色**: STT 轉錄 → 語意分析 → 配音切分

#### 任務清單

```
Day 1
⏸ 等待 Claude A 完成 Task 2.0 (Sync-1)
  可以先準備環境、測試 Whisper API

Day 1-2
□ Task 2.5: Whisper STT 整合 (3-4 小時)
  - 實作 Whisper API 呼叫
  - 儲存轉錄結果 (帶時間軸)
  - 成本追蹤整合

Day 2
□ Task 2.6: 語意分析 (4-5 小時)
  - 載入 Prompt (依賴 Task 2.0)
  - 呼叫 Gemini 進行分析
  - 提取關鍵字與主題
  - 儲存分析結果

Day 2-3
□ Task 2.7: 配音切分 (3-4 小時)
  - 實作基於時間軸的配音切分
  - 生成配音片段
  - 儲存到資料庫
  ⚠️ 完成後通知 Claude A (Sync-2)
```

**預估總時間**: 10-13 小時 (分散在 2-3 天)

#### 驗收標準

- [ ] Task 2.5: 配音可自動轉錄為文字
- [ ] Task 2.6: 轉錄文字可分析出關鍵字與語意
- [ ] Task 2.7: 配音可按語意切分為片段

---

### Claude D (智能選片路線)

**角色**: AI 選片決策 → 時間軸生成

#### 任務清單

```
Day 1-3 前半
⏸ 等待 Claude A 完成 Task 2.8 (Sync-3)
  可以先閱讀文件、準備測試資料

Day 3
□ Task 2.9: AI 選片決策 (5-6 小時)
  - 載入 Prompt (依賴 Task 2.0)
  - 呼叫 Task 2.8 取得候選片段
  - 實作 AI 選片邏輯 (Gemini)
  - 成本追蹤整合

Day 3-4
□ Task 2.10: 時間軸生成 (4-5 小時)
  - 生成時間軸 JSON
  - ⚠️ 快取候選片段到 Redis (新增)
  - 儲存到 timelines 表
  - 實作時間軸查詢 API
  ⚠️ 完成後通知 Claude E (Sync-4)
```

**預估總時間**: 9-11 小時 (分散在 1-2 天)

#### 驗收標準

- [ ] Task 2.9: AI 可根據配音選擇合適片段
- [ ] Task 2.10: 可生成完整時間軸 JSON
- [ ] Task 2.10: 候選片段已快取到 Redis

---

### Claude E (影片合成路線)

**角色**: FFmpeg 設定 → 影片合成 → 字幕疊加 → 配樂整合

#### 任務清單

```
Day 1-3
⏸ 等待 Claude D 完成 Task 2.10 (Sync-4)
  可以先準備 FFmpeg 環境、學習指令

Day 3-4
□ Task 2.11: FFmpeg 環境設定 (2-3 小時)
  - 安裝 FFmpeg
  - 測試 FFmpeg 指令
  - 建立 FFmpeg wrapper

Day 4
□ Task 2.12: 基礎影片合成 (4-5 小時)
  - 實作影片片段拼接
  - 實作配音合成
  - ⚠️ 實作異步處理機制 (新增)
  - ⚠️ 設定 Cloud Run timeout (新增)
  - 整合 Bull Queue

Day 4
□ Task 2.13: 字幕疊加 (3-4 小時)
  - 生成 SRT 字幕檔
  - 實作 FFmpeg 字幕疊加
  - 支援字幕樣式設定

Day 4
□ Task 2.14: 配樂整合 (3-4 小時)
  - 準備背景音樂庫
  - 實作音樂淡入淡出
  - 實作音量自動調整
```

**預估總時間**: 12-16 小時 (分散在 1-2 天)

#### 驗收標準

- [ ] Task 2.11: FFmpeg 環境正常運作
- [ ] Task 2.12: 可生成完整影片 (異步處理)
- [ ] Task 2.13: 影片包含字幕
- [ ] Task 2.14: 影片包含配樂

---

### Phase 2 整合測試

**執行者**: 全員
**時間**: Day 4-5 (4-5 小時)

```
□ Task 2.15: 核心引擎整合測試
  - 端到端測試 (上傳素材 → 上傳配音 → 生成影片)
  - 效能測試
  - 成本追蹤驗證

□ Task 2.16: Prompt A/B 測試機制
  - 實作 Prompt 版本切換
  - 實作效果追蹤
```

### Phase 2 完成標準

- [ ] Prompt 管理系統正常運作
- [ ] 可以上傳素材影片並自動分析
- [ ] 可以上傳配音並自動轉錄、分析
- [ ] 可以根據配音自動選片
- [ ] 可以生成完整影片 (含字幕、配樂)
- [ ] 所有核心引擎整合測試通過
- [ ] Prompt 版本追蹤與 A/B 測試機制已建立

---

## Phase 3: 前端介面開發 (並行開發 ⭐️)

**目標**: 建立完整的用戶介面
**總時間**: 預估 2-3 天 (實際日曆時間)
**執行方式**: 3 組並行,需注意前置依賴

### 前置作業 (順序執行)

**執行者**: Claude A 或 Claude B (任一)

```
□ Task 3.1: Next.js 專案設定 (2-3 小時)
□ Task 3.2: 登入/註冊頁面 (3-4 小時)
```

**完成後**: 進入 3 組並行開發

---

### Claude A (素材管理組)

```
□ Task 3.3: 素材上傳介面 (4-5 小時)
□ Task 3.4: 素材庫瀏覽 (4-5 小時)
```

**預估**: 8-10 小時

---

### Claude B (配音管理組)

```
□ Task 3.5: 配音錄製/上傳 (5-6 小時)
```

**預估**: 5-6 小時

---

### Claude C (影片生成組)

```
□ Task 3.6: 影片生成介面 (4-5 小時)
  ⚠️ 加入進度輪詢邏輯 (新增)
  ⚠️ 加入進度條 UI (新增)

□ Task 3.7: 影片預覽播放 (3-4 小時)

□ Task 3.8: 下載與分享 (2-3 小時)

□ Task 3.9: 時間軌編輯器 (6-8 小時) ⚠️ 新增
  - 時間軌 UI 組件
  - 片段替換功能
  - 預覽播放
```

**預估**: 15-20 小時

---

### Phase 3 完成標準

- [ ] 用戶可以完整走過所有流程
- [ ] UI/UX 符合設計規範
- [ ] 響應式設計 (手機/平板/桌面)
- [ ] 載入狀態與錯誤處理完善
- [ ] 進度顯示正常運作
- [ ] 時間軌編輯器正常運作

---

## Phase 4: 整合測試與部署 (順序執行)

**執行者**: Claude A (組長)
**時間**: 1-2 天

```
□ Task 4.1: 整合測試 (4-5 小時)
□ Task 4.2: 效能測試 (3-4 小時)
□ Task 4.3: GCP Cloud Run 部署 (4-5 小時)
□ Task 4.4: Vercel 前端部署 (2-3 小時)
□ Task 4.5: 監控與告警設定 (3-4 小時)
```

### Phase 4 完成標準

- [ ] 所有端對端測試通過
- [ ] 效能符合預期
- [ ] 已部署到正式環境
- [ ] 監控系統運作中

---

## Phase 5: 管理後台開發 (並行開發 ⭐️)

**目標**: 建立管理後台
**時間**: 預估 2-3 天
**執行方式**: 可 3-5 人並行

### Claude A (Dashboard 組)

```
□ Task 5.1: Dashboard 總覽頁面 (5-6 小時)
```

### Claude B (成本監控組)

```
□ Task 5.2: 成本分析模組 (5-6 小時)
□ Task 5.3: 效能監控模組 (4-5 小時)
```

### Claude C (系統管理組)

```
□ Task 5.4: 任務管理模組 (5-6 小時)
□ Task 5.5: 用戶管理模組 (4-5 小時)
```

### Claude D (設定管理組)

```
□ Task 5.6: 系統設定與 Prompt 管理 (5-6 小時)
```

### Phase 5 完成標準

- [ ] Dashboard 可正常顯示所有指標
- [ ] 成本分析報表正確無誤
- [ ] 效能監控資料準確
- [ ] 可查看與重試失敗任務
- [ ] 可管理用戶與配額
- [ ] 可管理 Prompt 版本與快取
- [ ] 權限控制正常運作

---

## 📊 整體時間軸預估

| Phase | 執行方式 | 工作量 (人時) | 實際日曆時間 | 累計天數 |
|-------|---------|-------------|------------|---------|
| Phase 0 | 順序 (1人) | 7-11 小時 | 1-1.5 天 | 1-2 天 |
| Phase 1 | 順序 (1人) | 18-25 小時 | 2.5-3 天 | 3-5 天 |
| Phase 2 | 並行 (5人) | 51-66 小時 | 3-4 天 | 6-9 天 |
| Phase 3 | 並行 (3人) | 28-41 小時 | 2-3 天 | 8-12 天 |
| Phase 4 | 順序 (1人) | 16-21 小時 | 2-3 天 | 10-15 天 |
| Phase 5 | 並行 (4人) | 28-34 小時 | 2-3 天 | 12-18 天 |

**總工作量**: 148-198 人時
**總日曆時間**: 12-18 天 (約 2.5-3.5 週)

**節省時間**: 相比單人開發 (34-50 天),並行開發可節省 **16-32 天**

---

## ⚠️ 風險管理

### 關鍵風險

| 風險 | 等級 | 緩解措施 |
|------|------|---------|
| Sync Point 延誤 | 🔴 高 | 預留 buffer time,提前完成關鍵 Task |
| Git 衝突 | 🟡 中 | 明確分工,避免修改相同檔案 |
| 整合問題 | 🟡 中 | 頻繁溝通,定期整合測試 |
| Task 估時不準 | 🟢 低 | 每個 Task 預留 20% buffer |

### 溝通機制

1. **Daily Sync**: 每天結束前同步進度
2. **Sync Point 通知**: 完成關鍵 Task 立即通知
3. **遇到問題**: 立即在共享文件記錄
4. **Code Review**: 每完成一個 Task 互相 review

---

## 📝 進度追蹤模板

### Phase 2 進度表

| Claude | Day 1 | Day 2 | Day 3 | Day 4 | 狀態 |
|--------|-------|-------|-------|-------|------|
| Claude A | Task 2.0 ✅ | Task 2.1 ⏳ | Task 2.8 ⏸ | - | ⏳ 進行中 |
| Claude B | ⏸ 等待 | Task 2.2 ⏸ | Task 2.3-2.4 ⏸ | - | ⏸ 待開始 |
| Claude C | ⏸ 等待 | Task 2.5 ⏸ | Task 2.6-2.7 ⏸ | - | ⏸ 待開始 |
| Claude D | ⏸ 等待 | ⏸ 等待 | ⏸ 等待 | Task 2.9-2.10 ⏸ | ⏸ 待開始 |
| Claude E | ⏸ 等待 | ⏸ 等待 | ⏸ 等待 | Task 2.11-2.14 ⏸ | ⏸ 待開始 |

**圖例**: ⏸ 待開始 | ⏳ 進行中 | ✅ 已完成 | ❌ 失敗

---

## ✅ 開始前檢查清單

在開始並行開發前,請確認:

### 環境準備

- [ ] 所有 Claude Code 都已安裝並設定
- [ ] 所有必要的 API Keys 已取得
  - [ ] Supabase URL & Keys
  - [ ] GCP Project & Credentials
  - [ ] OpenAI API Key
  - [ ] Gemini API Key
- [ ] Git repository 已建立
- [ ] 每個 Claude 都可以存取 repository

### 文件準備

- [ ] P0 問題已修復 (Task 3.9, 3.6, 2.12, 2.10)
- [ ] 所有 Task 文件已更新
- [ ] 所有 Claude 都已閱讀相關文件

### 分工確認

- [ ] 已指派每個 Claude 的角色
- [ ] 已建立溝通管道
- [ ] 已建立進度追蹤文件

---

## 📚 相關文件

- [00-INDEX.md](./00-INDEX.md) - 執行計劃總索引
- [01-project-overview.md](./01-project-overview.md) - 專案總覽
- [PARALLEL-WORK-INSTRUCTIONS.md](./PARALLEL-WORK-INSTRUCTIONS.md) - 並行工作指引

---

**完成檢查**:
- [x] 定義了並行開發策略
- [x] 明確了每個 Claude 的分工
- [x] 標示了所有同步點
- [x] 提供了時間軸預估
- [x] 識別了關鍵風險
- [x] 提供了進度追蹤模板

**準備開始**:
- [ ] 修復所有 P0 問題
- [ ] 確認環境準備完成
- [ ] 開始 Phase 0
