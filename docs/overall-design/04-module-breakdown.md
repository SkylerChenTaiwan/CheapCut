# 步驟 4：模組初步拆解

**狀態**：⬜️ 未開始
**前置依賴**：02-key-flows.md, 03-system-boundary.md
**目標**：將系統拆分成幾個大模組，定義各自職責

---

## 模組架構圖（待填寫）

```
┌──────────────────────────────────────┐
│           前端層（Frontend）          │
└──────────────────────────────────────┘
                  ↓ HTTP/WebSocket
┌──────────────────────────────────────┐
│           API 層（Backend）           │
└──────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────┐
│         業務邏輯層（Services）        │
└──────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────┐
│        資料存取層（Data Layer）       │
└──────────────────────────────────────┘
```

---

## 模組職責表

### 模組 1：前端應用（Frontend）

**職責**：

**主要功能**：
- [ ]
- [ ]

**技術選型**：（基於步驟 6）

**輸入**：

**輸出**：

**與其他模組的介面**：
- 呼叫：API 層
- 被呼叫：無

---

### 模組 2：API 服務（Backend API）

**職責**：

**主要功能**：
- [ ]
- [ ]

**技術選型**：

**輸入**：

**輸出**：

**與其他模組的介面**：
- 呼叫：業務邏輯層
- 被呼叫：前端

---

### 模組 3：影片生成引擎（Video Generator）

**職責**：

**主要功能**：
- [ ] 腳本解析
- [ ] 素材準備
- [ ] 影片組裝
- [ ]

**技術選型**：

**輸入**：

**輸出**：

**與其他模組的介面**：
- 呼叫：AI 服務適配器、素材管理器
- 被呼叫：業務邏輯層

---

### 模組 4：AI 服務適配器（AI Service Adapter）

**職責**：統一封裝各種 AI 服務的呼叫

**主要功能**：
- [ ] 文字生成
- [ ] 圖片生成
- [ ] 語音合成
- [ ] 錯誤處理與重試

**技術選型**：

**輸入**：

**輸出**：

**與其他模組的介面**：
- 呼叫：外部 AI API
- 被呼叫：影片生成引擎

---

### 模組 5：素材管理器（Asset Manager）

**職責**：

**主要功能**：
- [ ] 素材搜尋（從素材庫）
- [ ] 素材下載與快取
- [ ] 素材儲存管理
- [ ]

**技術選型**：

**輸入**：

**輸出**：

**與其他模組的介面**：
- 呼叫：外部素材 API、儲存服務
- 被呼叫：影片生成引擎

---

### 模組 6：任務佇列（Task Queue）（可選）

**職責**：

**是否需要**：[ ] 是 / [ ] 否

**如果需要**：
- 技術選型：
- 主要功能：
  - [ ] 任務排程
  - [ ] 優先級管理
  - [ ] 進度追蹤

---

### 模組 7：資料存取層（Data Access）

**職責**：

**主要功能**：
- [ ] 用戶資料 CRUD
- [ ] 影片專案資料 CRUD
- [ ] 任務狀態管理

**技術選型**：

**資料模型**：（詳細在後續文件）

---

## 模組間資料流

### 流程 1：影片生成
```
前端
  → API 層（接收請求）
  → 業務邏輯層（驗證、建立任務）
  → 影片生成引擎
     → AI 適配器（生成內容）
     → 素材管理器（取得素材）
  → 影片生成引擎（組裝）
  → 素材管理器（儲存影片）
  → API 層（回傳結果）
  → 前端（顯示）
```

---

## 模組職責矩陣

| 功能 | 負責模組 | 協作模組 |
|------|----------|----------|
| 接收用戶輸入 | 前端 | - |
| API 路由與驗證 | API 層 | - |
| 腳本處理 | 影片生成引擎 | AI 適配器 |
| 圖片生成 | AI 適配器 | - |
| 素材取得 | 素材管理器 | - |
| 影片組裝 | 影片生成引擎 | - |
| 儲存影片 | 素材管理器 | - |
| 任務狀態追蹤 | 資料存取層 | API 層 |

---

## 關鍵介面定義（概要）

### 介面 1：前端 ↔ API
```typescript
// 建立影片任務
POST /api/videos
Request: { script: string, options: VideoOptions }
Response: { taskId: string, status: string }

// 查詢任務狀態
GET /api/videos/:taskId
Response: { taskId, status, progress, videoUrl? }
```

---

### 介面 2：API ↔ 影片生成引擎
```typescript
// 內部函式呼叫
generateVideo(script: string, options: VideoOptions): Promise<VideoResult>
```

---

### 介面 3：影片生成引擎 ↔ AI 適配器
```typescript
generateImage(prompt: string): Promise<ImageUrl>
generateVoice(text: string): Promise<AudioUrl>
```

---

## 部署考量

### 模組部署方式

| 模組 | 部署方式 | 原因 |
|------|----------|------|
| 前端 | Vercel / Netlify | |
| API 層 | | |
| 影片生成引擎 | | |
| 任務佇列 | | |

---

**完成檢查**：
- [ ] 將系統拆分成清楚的模組
- [ ] 定義了每個模組的職責邊界
- [ ] 畫出了模組間的資料流
- [ ] 定義了關鍵介面（概要）

**完成後**：更新 `00-INDEX.md` 狀態，繼續步驟 5
